{% load static %}
<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="{% static 'images/logo1.png' %}">

    <title>TCPL</title>
    <!-- This is how to include a static file -->
    <link rel="stylesheet" href="{% static 'css/mystyle.css' type='text/css' %}" />
    <!-- <link rel="stylesheet" href="{% static 'libs/jquery.jsjquery-ui-1.12.1/jquery-ui.css' %}"> -->
    <!-- Leaflet -->
    <link rel="stylesheet" href="{% static 'libs/leaflet/leaflet.css' %}" />
     <!-- BOOTSTRAP only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- ZoomBar & slider-->
    <link rel="stylesheet" href="{% static 'libs/L.Control.ZoomBar-master/src/L.Control.ZoomBar.css' %}" />
    <link rel="stylesheet" href="{% static 'libs/Leaflet.zoomslider-master/src/L.Control.Zoomslider.css' %}" />
    <!-- MousePosition -->
    <link rel="stylesheet" href="{% static 'libs/Leaflet.MousePosition-master/src/L.Control.MousePosition.css ' %}" />
    <!-- line-measure -->
    <link rel="stylesheet" href="{% static 'libs/polyline-measure/line-measure.css' %}" />
    <link rel="stylesheet" href="{% static 'libs/leaflet-measure-master/leaflet-measure.css' %}" />
    <!-- draw -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.css" />
    <!-- legend -->
    <link rel="stylesheet" href="{% static 'libs/leaflet-wms-legend/leaflet.wmslegend.css' %}" />
    <!-- html2pdfcdn -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script> -->
    <!-- fontawsome -->
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css">
    <!-- Add SweetAlert CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">

  
  
<!-- Add your other JavaScript code -->
<style>
    
  .my-swal-container
  {
    
    align-items: center;
    padding: 5px;
    font-size: 10px;
  }
  .my-swal-input{
   
    width: 85%;
    color:black;
  }
  .my_swal_title{
    font-size: 20px;
  }
  .my-swal-button{
    padding: 10px;
  }
  .my_icon{
    font-size: 10px;
  }
  .my_swal_text{
    font-size: 8px;
  }

    @import url('https://fonts.googleapis.com/css?family=Roboto');

body{
	font-family: 'Roboto', sans-serif;
}
* {
	margin: 0;
	padding: 0;
}
i {
	margin-right: 10px;
}
/*----------bootstrap-navbar-css------------*/
.navbar-logo{
	padding: 15px;
	color: #fff;
}
.navbar-mainbg{
	background-color: #eeeeee;
	padding: 0px;
}
#navbarSupportedContent{
	overflow: hidden;
	position: relative;
}
#navbarSupportedContent ul{
	padding: 0px;
	margin: 0px;
}
#navbarSupportedContent ul li a i{
	margin-right: 10px;
}
#navbarSupportedContent li {
	list-style-type: none;
	float: left;
}
#navbarSupportedContent ul li a{
	color: rgba(255,255,255,0.5);
    text-decoration: none;
    font-size: 15px;
    display: block;
    padding: 20px 20px;
    transition-duration:0.6s;
	transition-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    position: relative;
}
#navbarSupportedContent>ul>li.active>a{
	color: #004aad;
	background-color: transparent;
	transition: all 0.7s;
}
#navbarSupportedContent a:not(:only-child):after {
	content: "\f105";
	position: absolute;
	right: 20px;
	top: 10px;
	font-size: 14px;
	font-family: "Font Awesome 5 Free";
	display: inline-block;
	padding-right: 3px;
	vertical-align: middle;
	font-weight: 900;
	transition: 0.5s;
}
#navbarSupportedContent .active>a:not(:only-child):after {
	transform: rotate(90deg);
}
.hori-selector{
	display:inline-block;
	position:absolute;
	height: 100%;
	top: 0px;
	left: 0px;
	transition-duration:0.6s;
	transition-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55);
	background-color: #fff;
	border-top-left-radius: 15px;
	border-top-right-radius: 15px;
	margin-top: 10px;
}
.hori-selector .right,
.hori-selector .left{
	position: absolute;
	width: 25px;
	height: 25px;
	background-color: #fff;
	bottom: 10px;
}
.hori-selector .right{
	right: -25px;
}
.hori-selector .left{
	left: -25px;
}
.hori-selector .right:before,
.hori-selector .left:before{
	content: '';
    position: absolute;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: #eeeeee;
}
.hori-selector .right:before{
	bottom: 0;
    right: -25px;
}
.hori-selector .left:before{
	bottom: 0;
    left: -25px;
}


@media(min-width: 992px){
	.navbar-expand-custom {
	    -ms-flex-flow: row nowrap;
	    flex-flow: row nowrap;
	    -ms-flex-pack: start;
	    justify-content: flex-start;
	}
	.navbar-expand-custom .navbar-nav {
	    -ms-flex-direction: row;
	    flex-direction: row;
	}
	.navbar-expand-custom .navbar-toggler {
	    display: none;
	}
	.navbar-expand-custom .navbar-collapse {
	    display: -ms-flexbox!important;
	    display: flex!important;
	    -ms-flex-preferred-size: auto;
	    flex-basis: auto;
	}
}


@media (max-width: 991px){
	#navbarSupportedContent ul li a{
		padding: 12px 30px;
	}
	.hori-selector{
		margin-top: 0px;
		margin-left: 10px;
		border-radius: 0;
		border-top-left-radius: 25px;
		border-bottom-left-radius: 25px;
	}
	.hori-selector .left,
	.hori-selector .right{
		right: 10px;
	}
	.hori-selector .left{
		top: -25px;
		left: auto;
	}
	.hori-selector .right{
		bottom: -25px;
	}
	.hori-selector .left:before{
		left: -25px;
		top: -25px;
	}
	.hori-selector .right:before{
		bottom: -25px;
		left: -25px;
	}
}
  </style>
        </head>
    <body style="overflow: hidden; color: #f8f9fa;">

       

        <div>

          
             <div id="navbar-wrapper">
          
                <nav class="navbar navbar-expand-custom navbar-mainbg">
                  <a class="text-decoration-none" href="{% url 'zoneDetail' %}">
                    <h5 class="p-2 text-left tcplBlue"> <img  class="imglogo" src="{% static 'images/logo1.png' %}" alt="image not found" style="width: 50px; height: 50px;"> TCPLGeo</h5>

                    
                  </a>
                  <button class="navbar-toggler" type="button" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <i class="fas fa-bars text-white"></i>
                  </button>
                  
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                      <ul class="navbar-nav ms-auto">
                          <div class="hori-selector"><div class="left"></div><div class="right"></div></div>
                          {% comment %} <li class="nav-item" id="box">
                            <a class="nav-link" id="button"><i class="far fa-clone"></i> Make Query 
                                  <form action="" id="form">
                                      <div id="filter-tag">
                                          <table>
                                              <tr>
                                                  <td>
                                                      <label for="layer" style="font-size: 12px; padding: 2px;  font-weight: bold;">Select Layer</label>
                                                  </td>
                                                  <td>
                                                      <select class="form-control" id="layer" name="layer" style="font-size: 10px;">
                                                          <option value="" >Select Layer</option>
                                                      </select>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <label for="attributes" style="font-size: 12px; padding: 2px; font-weight: bold;">Select Column</label>
                                                  </td>
                                                  <td>
                                                      <select class="form-control" id="attributes" name="attributes" style="font-size: 10px;">
                                                          <option value="">Select Attributes</option>
                                                      </select>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <label for="operator" style="font-size: 12px; padding: 2px; font-weight: bold;">Select_Operator</label>
                                                  </td>
                                                  <td>
                                                      <select class="form-control" id="operator" name="operator" style="font-size: 10px;">
                                                          <option value="">Select operator</option>
                                                      </select>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <label for="value" style="font-size: 12px; padding: 2px; font-weight: bold;">Enter Value</label>
                                                  </td>
                                                  <td>
                                                      <select class="form-control" id="selectvalue" name="selectvalue" style="font-size: 10px;" >
                                                          <option value="">select value</option>
                                                      </select>
                                                  </td>
                                              </tr>
                                              <tr>
                                           
                                                      <button class="btn btn-success" onclick="event.preventDefault();  loadMap()" style="font-size: 13px;">Load Query</button>
                                            
                                              </tr>
                                              <tr>
                                                
                                                  <!-- <p>selected query</p> -->
                                                  <p id="textval" style="font-size: 10px; color: black;"> </p>
                                               
                                              </tr>
                                          </table>
                                      </div>
                                  </form>
                           </a>
                        </li> {% endcomment %}
                          {% comment %} <li class="nav-item ">
                              <a class="nav-link" href="javascript:void(0);"><i class="far fa-address-book"></i>Search By Coordinates</a>
                          </li>
                           {% endcomment %}
                          
                         
                          <li class="nav-item active">
                              <a class="nav-link"><i class="fas fa-file-import"></i>Upload File</a>
                          </li>
                          <li class="nav-item">
                              <a class="nav-link" id="saveBtn" class="nav-link" > <i class="fal fa-plus-circle"></i> Create Bookmark</a>
                             
                          </li>

                          <li class="nav-item">
                            
                            <a href="javascript:void(0);" class="nav-link profile-username fw-bold text-capitalize" style="font-size: 15px; color: #004aad;" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                              {{ user.username }}
                              </a>
                        </li>
                          <li class="nav-item">
                              <a class="nav-link" href="{% url 'logout' %}" class="text-danger fw-bold p-1 px-2" style="border: 0; font-size: 15px; border-radius: 10px;" name="Logout" type="submit">
                                <i class="fas fa-sign-out-alt"></i>
                                <span class="d-none d-sm-inline">logout</span>
                            </a>
                          </li>
                       
                      </ul>
                  </div>
              </nav>

             </div>
            <section id="content-wrapper">
                <div id="map" class="leaflet-container"></div>
    
                <div id="main">
                   <div class="main_search">
                    

                        <input type="text" placeholder="Search.." name="search2" class="search" id="search-input">
    
                        <button class="bg-light" id="btnData2" type="button" ><i class="far fa-search"></i></button>
                    
    
                        <button class="btn-success" id="btnData1" type="button" onclick="ClearMe()">Clear</button>
    
 
    
                  </div>
    
                </div>
            </section>
    
    
        </div>

       
      </div>
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
      <!--html2pdf--> 
      <script src="{% static 'js/jspdf.umd.min.js' %}"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.16/jspdf.plugin.autotable.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
      
  <!-- jquery -->
        <script>
          var logoimage = "{% static 'images/logo1.png' %}"; // Replace with the actual URL of your image
          var imageUrl = "{% static 'images/legend1.png' %}"; // Replace with the actual URL of your image
        </script>
                
                    <!-- jquery -->
                    <script
                        src="https://code.jquery.com/jquery-3.7.0.min.js"
                        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g="
                        crossorigin="anonymous"></script>
                    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
                    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
                    
                    <script>
                      $(function() {
                // Initialize autocomplete widget

                $("#search-input").autocomplete({
                source: "/autocomplete/",
                });
                });




                

                    </script>
                    
                    
                    
                    
                    <!--leaflet-->
                    <script src="{% static 'libs/leaflet/leaflet.js' %}"></script>
                      <!--Bootstrap-->
                    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
                      <!--Zoombar-->
                    <script  src="{% static 'libs/L.Control.ZoomBar-master/src/L.Control.ZoomBar.js' %}"></script>
                    <script src="{% static 'libs/Leaflet.zoomslider-master/src/L.Control.Zoomslider.js' %}"></script>
                      <!--Mouse-position-->        
                    <script src="{% static 'libs/Leaflet.MousePosition-master/src/L.Control.MousePosition.js' %}"></script>
                      <!--line measurement-->        
                    <script src="{% static 'libs/polyline-measure/line-measure.js' %}"></script>
                      <!--meausrent-->        
                    <script src="{% static 'libs/leaflet-measure-master/leaflet-measure.js' %}"></script>
                    <script src="{% static 'libs/feat.js' %}"></script>
                      <!--draw-control-->        
                    <script src="{% static 'libs/leaflet-draw-control/leaflet-draw-control.js' %}"></script>
                      <!--legend-->        
                    <script src="{% static 'libs/leaflet-wms-legend/leaflet.wmslegend.js' %}"></script>
                      <!--html2pdf-->        
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
                        integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
                        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                      <!--leaflet-image-->        
                    <script src="{% static 'libs/leaflet-image.js' %}"></script>
                      <!--Leaflet Omnivore KML plugin -->       
                    <script src="https://unpkg.com/leaflet-omnivore/leaflet-omnivore.min.js"></script>
                      <!--sweetalert-->        
                    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>
                
                                      
                  
                   <script>
                    // Define a global JavaScript variable to hold the static image URL
                    var northImageUrl = "{% static 'images/North.png' %}";
                           </script>                 
          <script src="{% static 'js/map.js' %}"></script>




          <script>
// ---------Responsive-navbar-active-animation-----------
function test(){
	var tabsNewAnim = $('#navbarSupportedContent');
	var selectorNewAnim = $('#navbarSupportedContent').find('li').length;
	var activeItemNewAnim = tabsNewAnim.find('.active');
	var activeWidthNewAnimHeight = activeItemNewAnim.innerHeight();
	var activeWidthNewAnimWidth = activeItemNewAnim.innerWidth();
	var itemPosNewAnimTop = activeItemNewAnim.position();
	var itemPosNewAnimLeft = activeItemNewAnim.position();
	$(".hori-selector").css({
		"top":itemPosNewAnimTop.top + "px", 
		"left":itemPosNewAnimLeft.left + "px",
		"height": activeWidthNewAnimHeight + "px",
		"width": activeWidthNewAnimWidth + "px"
	});
	$("#navbarSupportedContent").on("click","li",function(e){
		$('#navbarSupportedContent ul li').removeClass("active");
		$(this).addClass('active');
		var activeWidthNewAnimHeight = $(this).innerHeight();
		var activeWidthNewAnimWidth = $(this).innerWidth();
		var itemPosNewAnimTop = $(this).position();
		var itemPosNewAnimLeft = $(this).position();
		$(".hori-selector").css({
			"top":itemPosNewAnimTop.top + "px", 
			"left":itemPosNewAnimLeft.left + "px",
			"height": activeWidthNewAnimHeight + "px",
			"width": activeWidthNewAnimWidth + "px"
		});
	});
}
$(document).ready(function(){
	setTimeout(function(){ test(); });
});
$(window).on('resize', function(){
	setTimeout(function(){ test(); }, 500);
});
$(".navbar-toggler").click(function(){
	$(".navbar-collapse").slideToggle(300);
	setTimeout(function(){ test(); });
});



    // ***************************************************************Make QUery***************************************************************

    $("#button").click(function() {
      $("#box form").toggle("slow");
      $(document).ready(function() {
          $.ajax({
              type: "GET",
              url: "https://portal.tcplgeo.com/geoservers/DP/wfs?request=getCapabilities",
              dataType: "xml",
              success: function(xml) {
                  var select1 = $('#layer');

                  $(xml).find('FeatureType').each(function() {
                      $(this).find('Name').each(function() {
                          var value = $(this).text();
                          select1.append(
                              "<option class='ddindent' value='" +
                              value + "'>" + value + "</option>");
                      });
                  });
              }
          });
      });
      $(function() {
          $("#layer").change(function() {
              var attributes = document.getElementById("attributes");
              var length = attributes.options.length;
              for (i = length - 1; i >= 0; i--) {
                  attributes.options[i] = null;
              }
              var value_layer1 = $(this).val();
              $(document).ready(function() {
                  $.ajax({
                      type: "GET",
                      url: "https://portal.tcplgeo.com/geoservers/wfs?service=WFS&request=DescribeFeatureType&version=1.1.0&typeName=" +
                          value_layer1,
                      dataType: "xml",

                      success: function(xml) {

                          var select2 = $('#attributes');
                          $(xml).find('xsd\\:sequence').each(function() {
                              $(this).find('xsd\\:element').each(
                                  function() {
                                      var value = $(this)
                                          .attr('name');
                                      var type = $(this).attr(
                                          'type');
                                      if (value != 'geom' &&
                                          value != 'the_geom'
                                      ) {
                                          select2.append(
                                              "<option class='ddindent' value='" +
                                              type +
                                              "'>" +
                                              value +
                                              "</option>");
                                      }
                                  });
                          });
                      }
                  })
              });
              document.getElementById("textval").innerHTML = value_layer1;
          })
      });
      $(function() {
          $("#attributes").change(function() {
              var operator = document.getElementById("operator");
              var attributes = $("#layer option:selected").text();
              var length = operator.options.length;
              for (i = length - 1; i >= 0; i--) {
                  operator.options[i] = null;
              }
              var value_type = $(this).val();
              var value_attribute = $('#attributes option:selected').text();
              operator.options[0] = new Option('Select operator', "");
              if (value_type == 'xsd:short' || value_type == 'xsd:int' || value_type ==
                  'xsd:double') {
                  var operator1 = document.getElementById("operator");
                  operator1.options[1] = new Option('>', '>');
                  operator1.options[2] = new Option('<', '<');
                  operator1.options[3] = new Option('=', '=');
                  operator1.options[4] = new Option('<=', '<=');
                  operator1.options[5] = new Option('=>', '=>');
                  operator1.options[6] = new Option('IN ()', 'IN');
                  operator1.options[7] = new Option('OR ||', 'OR');
                  operator1.options[8] = new Option('AND &', 'AND');
              } else if (value_type == 'xsd:string') {
                  var operator1 = document.getElementById("operator");
                  operator1.options[1] = new Option('Like', 'ILike');
                  operator1.options[2] = new Option('IN ()', 'IN');
                  operator1.options[3] = new Option('OR ||', 'OR');
                  operator1.options[4] = new Option('AND &', 'AND');
              }


              var selectvalue = document.getElementById("selectvalue");
              var length = selectvalue.options.length;
              for (i = length - 1; i >= 0; i--) {
                  selectvalue.options[i] = null;
              }

              $(document).ready(function() {
                  $.ajax({
                      type: "GET",
                      url: "https://portal.tcplgeo.com/geoservers/wfs?service=wfs&version=1.0.0&request=getfeature&typename=" +
                          attributes + "&PROPERTYNAME=" + value_attribute,
                      dataType: "xml",
                      success: function(xml) {
                          var select3 = $('#selectvalue');
                          var unq = new Array();
                          $(xml).each(function() {
                              $(this).find('gml\\:featureMember')
                                  .each(function() {
                                      unq.push($(this)
                                          .text());
                                  });
                              let unique = unq.filter((item, i,
                                  ar) => ar.indexOf(
                                  item) === i);
                              for (let i = 0; i < unique
                                  .length; i++) {
                                  select3.append(
                                      "<option class='ddindent' value='" +
                                      unique[i] + "'>" +
                                      unique[i] + "</option>");
                              }
                          });
                      }
                  });
              });
              document.getElementById("textval").innerHTML = "From Layer" + attributes +
                  " is " + value_attribute;
          });

      });
  });



  $(function() {
      $("#selectvalue").change(function() {
          var vars = ['layer', 'attributes', 'operator', 'selectvalue'];
          for (let i = 0; i < vars.length; i++) {
              //   var operator = document.getElementById("operator");
              var layer = $("#layer option:selected").text();
              var attributes = $("#attributes option:selected").text();
              var operator = $("#operator option:selected").text();
              var selectvalue = $("#selectvalue option:selected").text();
          }
          document.getElementById("textval").innerHTML = "From Layer " + layer + " column is " +
              attributes + " " + operator + " value is " + selectvalue;

          var sql_filter1 = attributes + " Like '" + selectvalue + "'"
          // console.log(sql_filter1)
          fitbou(sql_filter1, layer)

          var wms_layerf = L.tileLayer.wms(
              "https://portal.tcplgeo.com/geoservers/DP/wms", {
                  layers: layer,
                  format: "image/png",
                  transparent: true,
                  tiled: true,
                  version: "1.1.0",
                  attribution: "ugc",
                  opacity: 1,
                  cql_filter: sql_filter1,
                  styles: 'highlight',

              }
          );
          wms_layerf.addTo(map);


          function fitbou(filter, layer1) {
              var urlm =
                  "https://portal.tcplgeo.com/geoservers/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" +
                  layer1 + "&CQL_FILTER=" + filter + "&outputFormat=application/json";
              // console.log(urlm)
              $.getJSON(urlm, function(data) {
                  geojson = L.geoJson(data, {});
                  map.fitBounds(geojson.getBounds());
              });
          };


      });
  })

          </script>

      
    </body>
</html>
